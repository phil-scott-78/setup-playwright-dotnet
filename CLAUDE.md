# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- **Build**: `npm run build` - Compiles TypeScript and bundles with ncc
- **Test**: `npm test` - Runs Jest tests
- **Lint**: `npm run lint` - Runs ESLint on TypeScript files in src/

## Project Architecture

This is a GitHub Action that sets up Playwright.NET with automatic .NET version detection. The project structure follows GitHub Actions conventions:

### Core Files
- `src/index.ts` - Main entry point with all action logic
- `dist/index.js` - Bundled output (generated by ncc build)
- `action.yml` - GitHub Action metadata and inputs/outputs

### Key Components
- **Version Detection**: Parses `global.json` files using JSON5 to determine .NET version
- **PowerShell Management**: Automatically installs PowerShell on Linux/macOS if needed
- **Playwright Script Location**: Searches multiple paths for the Playwright PowerShell script based on .NET version
- **Platform Support**: Handles Linux, Windows, and macOS with platform-specific PowerShell installation

### Action Inputs
- `global-json-file`: Path to global.json (default: "global.json")
- `dotnet-version`: .NET version override (takes precedence over global.json)
- `with-deps`: Install system dependencies (default: true)
- `browsers`: Browsers to install (default: "all")
- `install-powershell`: Auto-install PowerShell if missing (default: true)

### Main Flow
1. Check/install PowerShell if needed
2. Determine .NET version from input or global.json
3. Locate the Playwright PowerShell script in build output directories
4. Execute the script with appropriate arguments

### Dependencies
- `@actions/core` and `@actions/exec` for GitHub Actions functionality
- `json5` for parsing global.json files with comments/trailing commas
- TypeScript with strict mode enabled
- `@vercel/ncc` for bundling the final action

### Build Process
The action must be built before each release since GitHub Actions run the bundled `dist/index.js` file, not the TypeScript source. Always run `npm run build` after making changes and commit the updated `dist/` directory.